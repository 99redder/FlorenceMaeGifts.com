<!----
  ======================================
; Title: request.html 
; Author: Red
; Date Created: 11 January 2023
; Last Updated: 12 February 2026
; Description: The code for the Florence Mae Gifts Request A Custom Piece Page (request.html)
; Sources Used: W3 Schools CSS Template https://www.w3schools.com/css/css_templates.asp
;=====================================
----->


<!DOCTYPE html>
<html lang="en">

  <head>
    
    <title>Request Custom Piece - Florence Mae Gifts - Premium Handmade Crochet Items</title>
    
    <meta name="description" content="Fill out the form to request a custom-made order from Florence Mae Gifts.">
    <meta http-equiv="author" content ="Red">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <!--Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora&family=Varela+Round&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sofia+Sans+Extra+Condensed:wght@100&display=swap" rel="stylesheet">
  
    <!--Style Sheets-->
    <link href="fmg.css" type="text/css" rel="stylesheet">
    <link href="logo-font/logo-font.css" type="text/css" rel="stylesheet">
  
    <!--Favorites Icon-->
    <link rel="icon" href="images/favicon.png">
    
    <!---Font Awesome Script-->
    <script src="https://kit.fontawesome.com/aeba1ec76b.js" crossorigin="anonymous"></script>
  
    <!---The JavaScript source doe for the theme functions setDefaultTheme and setSelectedTheme-->
    <script src="theme.js"></script>
    
    <!---The JavaScript source code for the include HTML function-->
    <script src="includeHTML.js"></script>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>

</head>

<body class="light-theme">

<!-- Creates the icon and adds the onclick functionality for changing between themes-->
<i onclick="toggleMode(this)" id="icon-mode" class="fa fa-toggle-off pull-right" style="font-size: 20px;"><span id="icon-text" class="toggle"></span></i><br><br>

<div w3-include-html="header.html" class="header"></div>

<div w3-include-html="topnav.html" class="topnav"></div>

<div class="row">

    <div class="leftcolumn">

      <h2>Request a Custom Piece</h2>
      <p>Submit your custom request below. Weâ€™ll review details and follow up with final pricing.</p>

      <form id="custom-order-form">
        <label for="customer-name">Name</label><br>
        <input id="customer-name" name="customerName" type="text" required><br><br>

        <label for="customer-email">Email</label><br>
        <input id="customer-email" name="customerEmail" type="email" required><br><br>

        <label for="order-notes">What would you like made?</label><br>
        <textarea id="order-notes" name="orderNotes" rows="6" required></textarea><br><br>

        <button id="start-checkout-btn" type="submit">Continue to Secure Checkout</button>
      </form>

      <p id="checkout-status" style="margin-top: 12px;"></p>

      <!--
        Stripe placeholders (replace later):
        - STRIPE_PUBLISHABLE_KEY_PLACEHOLDER
        - STRIPE_PRICE_ID_PLACEHOLDER
        - /api/create-checkout-session endpoint
      -->

    </div>
                    
    <div w3-include-html="rightcolumn.html" class="rightcolumn hidden-mobile"></div>

    <!---Closes all other divs and allows the disclaimer note to be the Footer--> 
    </div>

    <!---Footer-->
    <div w3-include-html="footer.html" class="stuff-centered"></div>  
  
         




<script>
  // sets a default theme; this code needs to be first
  setDefaultTheme();

  // the function which will toggle between the two different themes
  function toggleMode(x)
  {
      let colorTheme = document.body.classList; // establishes the variable that holds the body CSS class
      let iconMode = x.classList; // gets the classes 

      // if the value shows light, update the preference in storage
      if (colorTheme.value === "light-theme")
      {
          localStorage.clear();
          localStorage.setItem("mode", "dark-theme");
          localStorage.setItem("iconMode", "fa-toggle-on");
          localStorage.setItem("iconText", "Dark Mode");
      }
      
      else
      {
          localStorage.clear();
          localStorage.setItem("mode", "light-theme");
          localStorage.setItem("iconMode", "fa-toggle-off");
          localStorage.setItem("iconText", "Light Mode");
      }

      // applies the updated selection
      colorTheme.value = localStorage.getItem("mode");
      iconMode.value = `fa ${localStorage.getItem("iconMode")} pull-right`;
      document.getElementById("icon-text").innerHTML = localStorage.getItem("iconText");
  }

// Stripe placeholder config
const STRIPE_PUBLISHABLE_KEY = "pk_test_PLACEHOLDER";
const STRIPE_PRICE_ID = "price_PLACEHOLDER";
const CHECKOUT_ENDPOINT = "/api/create-checkout-session";

const customOrderForm = document.getElementById("custom-order-form");
const checkoutStatus = document.getElementById("checkout-status");
const stripe = window.Stripe ? Stripe(STRIPE_PUBLISHABLE_KEY) : null;

if (customOrderForm) {
  customOrderForm.addEventListener("submit", async function (event) {
    event.preventDefault();

    const customerName = document.getElementById("customer-name").value.trim();
    const customerEmail = document.getElementById("customer-email").value.trim();
    const orderNotes = document.getElementById("order-notes").value.trim();

    checkoutStatus.textContent = "Preparing secure checkout...";

    if (!stripe || STRIPE_PUBLISHABLE_KEY.includes("PLACEHOLDER")) {
      checkoutStatus.textContent = "Stripe is in placeholder mode. Add live Stripe keys + backend session endpoint to enable checkout.";
      return;
    }

    try {
      const response = await fetch(CHECKOUT_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          customerName,
          customerEmail,
          orderNotes,
          priceId: STRIPE_PRICE_ID
        })
      });

      if (!response.ok) throw new Error("Checkout session request failed");

      const data = await response.json();

      if (!data || !data.id) throw new Error("Missing Stripe session id");

      const stripeResult = await stripe.redirectToCheckout({ sessionId: data.id });

      if (stripeResult.error) {
        checkoutStatus.textContent = stripeResult.error.message;
      }
    } catch (error) {
      checkoutStatus.textContent = "Checkout is not live yet (placeholder backend).";
    }
  });
}

// allows for the import of the html files
includeHTML();

</script>

</body>
</html>